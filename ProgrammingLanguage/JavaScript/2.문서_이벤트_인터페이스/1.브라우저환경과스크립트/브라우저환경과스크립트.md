```table-of-contents
style: nestedList # TOC style (nestedList|inlineFirstLevel)
maxLevel: 0 # Include headings up to the speficied level
includeLinks: true # Make headings clickable
debugInConsole: false # Print debug info in Obsidian console
```
---
# 1. 브라우저 환경

-  Host : 자바스크립트가 구동되는 플랫폼
> 호스트 환경은 플랫폼에 특정되는 객체와 함수를 제공

- 웹 브라우저 환경에서 사용 가능한 기능
![[jsbrowser.png]]

## 1-1 window

- 최상단 `root` 전역 객체
- 브라우저 창을 제어하는 메서드 제공(`alert` 등)
- 모든 객체들의 최상위 객체, 메소드 앞에 window 명시할 필요 X
	- `alert`
	- `open`
	- `prompt`
	- `comfirm`
	- `setInterval / clearInterval` : 시간 간격으로 코드 반복 실행/중지(밀리 초)
		* 자체 내 밀리 초 단위의 오차 존재
	- `setTimeout, clearTimeout` : 일정 시간 후 코드 1번 실행 후 종료

## 1-2 문서 객체 모델(DOM)

- 웹 페이지 내의 모든 컨텐츠를 수정 가능한 객체로 나타냄
- `document` 객체는 페이지의 진입점을 나타냄
```
document.body.style.background = "red";
```

>*[DOM](https://dom.spec.whatwg.org/)*

## 1-3 CSS 객체 모델(CSSOM)

- CSS 규칙과 스타일 시트 객체 모델

>*[CSSOM](https://www.w3.org/TR/cssom-1/)*

## 1-4 브라우저 객체 모델(BOM)

- 문서 의외의 모든 것을 제어하기 위해 브라우저가 제공하는 객체

- `navigator` : 브라우저와 운영체제에 대한 정보 제공
	- `appCodeName` : 브라우저 코드
	- `appName` : 브라우저 이름
	- `appVersion` : 브라우저 버전 
	- `language` : 브라우저 사용 언어
	- `product` : 브라우저 엔진 이름
	- `platform` : OS 정보
	- `onLine` : 온라인 상태면 true 반환
	- `userAgent` : 브라우저/OS 종합 정보 반환

- `location ` : URL을 다루는 객체
	- `href` : 현재 페이지 URL 반환
	- `hash` : 현재 URL 해시값 반환
	- `port` : 현재 URL 포트번호 반환
	- `protocol` : 현재 URL 프로토콜 반환
	- `search` :  현재 URL 쿼리 반환
	- `reload()` : 페이지 새로고침
	- `replace()` : 지정된 URL 이동

- `history ` : 방문 기록 저장(앞/뒤로 가기)
	- `length` : 저장된 URL 수 반환
	- `go()` : 페이지 이동(양수 : 다음 , 음수 : 이전)
	- `back()` : 이전 방문 페이지 이동
	- `forward()` : 다음 방문 페이지 이동

- BOM은 [HTML 명세서]((https://html.spec.whatwg.org/) 내에 포함

---
# 2. 스크립트

## 2-1 스크립트 이벤트

### 2-1-1 DOMContentLoaded

- 브라우저가 HTML을 전부 읽고 DOM 트리 완성 즉시 발생
- 이미지 파일이나 스타일 시트 등의 기타 자원은 기다리지 않음
```
<script>
	document.addEventListener("DOMContentLoaded", ()=> {
		...
	})
</script>
```

- 브라우저는 HTML 처리 중 `<script>` 태그를 만나면 DOM 트리 구성을 멈추고 스크립트 실행
>따라서 모든 스크립트가 처리된 후에 `DOMContentLoaded` 이벤트 실행
>단, 2가지 예외가 존재
>	- `async` 속성이 있는 스크립트는 이벤트 동작을 막지 않음
>	- 동적으로 생성된 스크립트(`document.createElement('script')`)

- 외부 스타일시트가 로드되는 것을 기다리지 않음
>단, 스타일 시트 태그 바로 다음에 스크립트가 위치하면
>스타일 시트를 로드할 때까지 스크립트 실행을 기다림
```
<link rel="stylesheet" href="style.css">
<script>
	alert(getComputedSyle(document.body).marginTop);
	...
</script>
```

- 브라우저의 폼 자동 완성(form autofill)은 `DOMContetnLoaded` 이벤트 발생시 일어남

### 2-1-2 load

- DOM 트리 + 이미지 / 외부 자원 모두 불러오는 것이 끝났을 때 발생
- 화면에 적용되는 요소의 실제 크기 확인 가능

### 2-1-3 unload

- 사용자가 페이지를 떠날 때(문서 완전히 종료)
- 사용자가 진짜 떠날 때 사용자 분석 정보를 담은 통계자료 전송시 사용

- `navigator.sendBeacon(url, data)` 메서드는 데이터를 백그라운드에서 전송
>따라서 다른 페이지로 전환시에도 딜레이가 존재하지 않음
```
let analyticsData = { ... }

// POST 메서드로 전송, 전송데이터는 64kb를 넘을 수 없음
// 페이지를 떠날 경우 서버의 응답을 받을 수 없지만 대체로 빈 응답임
// fetch 메서드는 페이지를 떠난 후에도 요청이 가능한 플래그 keepalive 지원
window.addEventListener("unload", function(){
	navigator.sendBeacon("/analytics", JSON.stringfy(analyticsData))
})
```

### 2-1-4 beforeunload 

- 사용자가 페이지 떠나기 직전에 발생
- 변경되지 않은 사항 저장하였는지 확인할 때 사용
```
window.onbeforeunload = function(){
	return false; // 페이지 나가기 취소
}
```

- 최신 브라우저는 `beforeunload` 이벤트 취소시 발생하는 모달 메시지 커스터마이징 불가

![[beforeunload.PNG]]

### 2-1-5 readyState / readystatechange

- `document.readyState`  : 현재 로딩 상태를 알려주는 프로퍼티
	- `"loading"` : 문서 불러오는 중
	- `"interactive"` : DOM 트리 완성
	- `"complete"` : 이미지 리소스 또한 모두 불러옴

- `readystatechange` : 상태 변경시 실행되는 이벤트
```
document.addEventListener('redaystatechange', () => console.log(document.readyState))
```

- 상태 흐름
	1. State : loading
	2. State : interactive
		- DOMContentLoaded
		- iframe, img, etc onload
	3. State : complete
		- window onload

## 2-2 defer / async 스크립트

롤링인더디잎

---
>[[JavaScript]]
#BOM #DOM #Script